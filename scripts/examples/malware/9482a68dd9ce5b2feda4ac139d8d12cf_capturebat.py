#
# Malware md5: 9482a68dd9ce5b2feda4ac139d8d12cf
# https://www.virustotal.com/gui/file/dcec3a15d840be299f92c7d8c6330b75a9ae9718588b741a0b9c1c5756787d9c/detection
#

# Tool Imports
from bph.tools.windows.nircmd import BphNirCmd as NirCmd
from bph.tools.windows.capturebat import BphCaptureBat as CaptureBat

# Core Imports
from bph.core.server.template import BphTemplateServer as TemplateServer
from bph.core.session import BphSession as Session
from bph.core.sample import BphLabFile as LabFile

session = Session(project_name='blackhat_arsenal_2019')
session.start()
session.set_launcher(move_sample=False)

templateserver = TemplateServer()
templateserver.start()

capturebat = CaptureBat()
capturebat.cleanup()
capturebat.execute()

capturebat.start()
capturebat.execute()

sample_exec = NirCmd(LabFile(session.launcher_abs_path))
sample_exec.configuration.execution.background_run = False
sample_exec.start_process(program='@sample@')
sample_exec.execute()

capturebat.stop()
capturebat.execute()

capturebat.collect()
capturebat.execute()
capturebat.files()